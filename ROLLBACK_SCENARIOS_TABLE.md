# Rollback Scenarios Table

| Scenario | Rollback | Resource | Description | Module |
|----------|----------|----------|-------------|--------|
| [Application Outage Scenarios](ROLLBACK_SCENARIOS.md#application-outage-scenarios) | yes | `NetworkPolicy` | Create `NetworkPolicy` to block all traffic to the application pods, then sleep `duration` seconds, and finally delete the `NetworkPolicy`.<br><br>```yaml<br>apiVersion: networking.k8s.io/v1<br>kind: NetworkPolicy<br>metadata:<br>    name: krkn-deny-<get_random_string(5)><br>spec:<br>    podSelector:<br>    matchLabels: {{ pod_selector }}<br>    policyTypes: {{ traffic_type }}<br>``` | [application_outage_scenario_plugin.py](krkn/scenario_plugins/application_outage/application_outage_scenario_plugin.py) |
| [Container Scenarios](ROLLBACK_SCENARIOS.md#container-scenarios) | no | None | Kill specific containers (can be multiple) in the pod, then sleep `duration` seconds, and will retry on killing the containers if they are still running. | [container_scenario_plugin.py](krkn/scenario_plugins/container/container_scenario_plugin.py) |
| [Hog Scenarios](ROLLBACK_SCENARIOS.md#hog-scenarios) | yes | `Pod` | Use `lib_k8s.deploy_hog` to deploy hog pods, and then sleep `duration` seconds. While sleeping, will also collects the CPU, Memory, Disk space sample for the nodes. | [hogs_scenario_plugin.py](krkn/scenario_plugins/hogs/hogs_scenario_plugin.py) |
| [Managed Cluster Scenarios](ROLLBACK_SCENARIOS.md#managed-cluster-scenarios) | unknown | `ManifestWork` | Provides scenarios to test Open Cluster Management (OCM) or Red Hat Advanced Cluster Management by injecting faults with `ManifestWork` into ManagedClusters. The following actions are supported:<br>- Start/stop/restart ManagedCluster instances by scaling deployments<br>- Start/stop/restart the klusterlet agents<br>- All scenarios use ManifestWork resources to execute commands on the managed clusters | [managed_cluster_scenario_plugin.py](krkn/scenario_plugins/managed_cluster/managed_cluster_scenario_plugin.py) |
| [Native Scenario Plugin](ROLLBACK_SCENARIOS.md#native-scenario-plugin) | yes | `Job` | Leverage [arcaflow_plugin_sdk](https://github.com/arcalot/arcaflow-plugin-sdk-python/tree/main?tab=readme-ov-file) to execute the following steps:<br><br>```python<br>PLUGINS = Plugins(<br>    [<br>        PluginStep(<br>            kill_pods,<br>            [<br>                "error",<br>            ],<br>        ),<br>        PluginStep(wait_for_pods, ["error"]),<br>        PluginStep(run_python_file, ["error"]),<br>        PluginStep(network_chaos, ["error"]), # will create network chaos job<br>        PluginStep(pod_outage, ["error"]), # will create pod outage job<br>        PluginStep(pod_egress_shaping, ["error"]), # will create pod egress shaping job<br>        PluginStep(pod_ingress_shaping, ["error"]), # will create pod ingress shaping job<br>    ]<br>)<br>``` | [native_scenario_plugin.py](krkn/scenario_plugins/native/native_scenario_plugin.py) |
| [Network Chaos Scenarios](ROLLBACK_SCENARIOS.md#network-chaos-scenarios) | yes | `Job` | Creates network disruption on specified nodes by deploying `job` that apply network chaos conditions like bandwidth limitations, latency, or packet loss to specific network interfaces. Can run in serial or parallel mode across multiple nodes.<br><br>`krkn/scenario_plugins/network_chaos/job.j2`  <br>```yaml<br>apiVersion: batch/v1<br>kind: Job<br>metadata:<br>  name: chaos-{{jobname}}<br>spec:<br>  template:<br>    spec:<br>      nodeName: {{nodename}}<br>      hostNetwork: true<br>      containers:<br>      - name: networkchaos<br>        image: docker.io/fedora/tools<br>        command: ["/bin/sh",  "-c", "{{cmd}}"]<br>        securityContext:<br>          privileged: true<br>        volumeMounts:<br>          - mountPath: /lib/modules<br>            name: lib-modules<br>            readOnly: true<br>      volumes:<br>        - name: lib-modules<br>          hostPath:<br>            path: /lib/modules<br>      restartPolicy: Never<br>  backoffLimit: 0<br>``` | [network_chaos_scenario_plugin.py](krkn/scenario_plugins/network_chaos/network_chaos_scenario_plugin.py) |
| [Network Chaos NG Scenarios](ROLLBACK_SCENARIOS.md#network-chaos-ng-scenarios) | yes | `Pod` | Create pods with `templates/network-chaos.j2` template and run `iptables` commands inside them to apply network chaos conditions like bandwidth limitations, latency, or packet loss to specific network interfaces. This is a more advanced and flexible version of the original network chaos scenario.<br><br><br>`krkn/scenario_plugins/network_chaos_ng/modules/templates/network-chaos.j2`  <br><br>```yaml<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: {{pod_name}}<br>  namespace: {{namespace}}<br>spec:<br>  {% if host_network %}<br>  hostNetwork: true<br>  {%endif%}<br>  nodeSelector:<br>    kubernetes.io/hostname: {{target}}<br>  containers:<br>  - name: fedora<br>    imagePullPolicy: Always<br>    image: quay.io/krkn-chaos/krkn-network-chaos:latest<br>    securityContext:<br>      privileged: true<br>``` | [network_chaos_ng_scenario_plugin.py](krkn/scenario_plugins/network_chaos_ng/network_chaos_ng_scenario_plugin.py) |
| [Node Actions Scenarios](ROLLBACK_SCENARIOS.md#node-actions-scenarios) | partially | `Node` (restarting nodes, reattaching disks, etc.) | Disrupts nodes as part of the cluster infrastructure by talking to the cloud API for AWS, Azure, GCP, OpenStack, Baremetal, VMware, Docker, Alibaba and IBMCloud. Various actions include:<br>- Start/stop/reboot/terminate nodes<br>- Crash or disrupt node services like kubelet<br>- Block network access<br>- Detach/attach storage<br>- Multiple implementations for different cloud providers<br><br>Note: the entrypoint class is `NodeActionsScenarioPlugin` | [node_actions_scenario_plugin.py](krkn/scenario_plugins/node_actions/node_actions_scenario_plugin.py) |
| [PVC Scenarios](ROLLBACK_SCENARIOS.md#pvc-scenarios) | yes | `PersistentVolumeClaim` (deleting the temporary file) | Use `fallocate` or `dd` to fill up the PVC with `target_fill_percentage` in `<mount_path>/kraken.tmp` temporary file. | [pvc_scenario_plugin.py](krkn/scenario_plugins/pvc/pvc_scenario_plugin.py) |
| [Service Disruption Scenarios](ROLLBACK_SCENARIOS.md#service-disruption-scenarios) | yes | `Service`, `DaemonSet`, `StatefulSet`, `ReplicaSet`, `Deployment` (should restore the original resources) | Will get namespaces with `namespace` or `label_selector` parameters, and then take randomly 1 namespace from them as the target namespace.<br><br>Delete all `service` and `pod` (including `DaemonSet`, `StatefulSet`, `ReplicaSet` and `Deployment` resources) in the cluster for target namespaces. | [service_disruption_scenario_plugin.py](krkn/scenario_plugins/service_disruption/service_disruption_scenario_plugin.py) |
| [Service Hijacking Scenarios](ROLLBACK_SCENARIOS.md#service-hijacking-scenarios) | yes | `Service`, `Pod`, `ConfigMap` (should restore the original Service selector and delete the hijacking service resources) | Simulates fake HTTP responses from a workload targeted by a `Service` already deployed in the cluster. This scenario deploys a custom web service and modifies the target `Service` selector to direct traffic to this web service for a specified duration.<br><br>Will<br>- create the following resources:<br>    - namespaced `ConfigMap`<br>    - `Pod` (running Flask app)<br>- replace the `Service` selector with the hijacking service selector | [service_hijacking_scenario_plugin.py](krkn/scenario_plugins/service_hijacking/service_hijacking_scenario_plugin.py) |
| [Shut Down Scenarios](ROLLBACK_SCENARIOS.md#shut-down-scenarios) | yes | `Node` (restarting nodes) | Shuts down all nodes in a cluster (including master nodes) for a specified duration and then restarts them. This simulates a complete power outage scenario. Supports AWS, Azure, GCP, OpenStack, and IBMCloud providers. | [shut_down_scenario_plugin.py](krkn/scenario_plugins/shut_down/shut_down_scenario_plugin.py) |
| [Syn Flood Scenarios](ROLLBACK_SCENARIOS.md#syn-flood-scenarios) | yes | `Pod` | Performs SYN flood attacks (a form of denial of service) with `pod` resource. | [syn_flood_scenario_plugin.py](krkn/scenario_plugins/syn_flood/syn_flood_scenario_plugin.py) |
| [Time Actions Scenarios](ROLLBACK_SCENARIOS.md#time-actions-scenarios) | yes | N/A | Manipulates the system time on `node` or `pod` resources. | [time_actions_scenario_plugin.py](krkn/scenario_plugins/time_actions/time_actions_scenario_plugin.py) |
| [Zone Outage Scenarios](ROLLBACK_SCENARIOS.md#zone-outage-scenarios) | yes | `Node` (for GCP), `Network ACL` (for AWS) | Simulates a failure in an entire availability zone/region by either:<br><br><br>1. Stopping all nodes in the zone (for GCP)<br>2. Implementing network ACL blocks (for AWS)<br>The scenario maintains the outage for a specified duration before recovery. | [zone_outage_scenario_plugin.py](krkn/scenario_plugins/zone_outage/zone_outage_scenario_plugin.py) |
